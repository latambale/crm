<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Manage Managers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #f5d1ff, #c1eaff);
      --card-gradient: linear-gradient(145deg, #ffffff, #f0f8ff);
      --button-gradient: linear-gradient(145deg, #f271c4, #aa52f2);
      --accent-color: #5e35b1;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--primary-gradient);
      min-height: 100vh;
    }

    header {
      background: var(--button-gradient);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    header h1 {
      font-size: 1.3rem;
      margin: 0;
      text-shadow: 1px 1px 0 #ffffff33;
    }

    #menuToggle {
      all: unset;
      background: transparent;
      border: none;
      font-size: 1.6rem;
      color: white;
      cursor: pointer;
      display: none;
    }

    .sidebar {
      width: 240px;
      background: var(--accent-color);
      color: white;
      padding: 1.2rem 1rem;
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      z-index: 1000;
      transform: translateX(0);
      transition: transform 0.3s ease;
    }

    .sidebar h2 {
      font-size: 1.1rem;
      margin-bottom: 1.2rem;
    }

    .sidebar a {
      display: block;
      text-decoration: none;
      color: white;
      background: #6a4cbc;
      margin-bottom: 0.6rem;
      padding: 0.8rem 1rem;
      border-radius: 1rem;
      font-size: 0.95rem;
      transition: background 0.3s;
    }

    .sidebar a:hover {
      background: #7e5be0;
    }

    .container {
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
    }


    .card {
      background: var(--card-gradient);
      border-radius: 2rem;
      padding: 2rem 1.5rem;
      box-shadow: inset 4px 4px 10px #d1d9e6, inset -4px -4px 10px #ffffff;
      max-width: 500px;
      margin-bottom: 2rem;
    }

    .card h2 {
      margin-bottom: 1rem;
      color: #6a1b9a;
      font-size: 1.2rem;
      text-align: center;
    }

    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 0.9rem 1.1rem;
      margin-bottom: 1rem;
      border: none;
      border-radius: 1.5rem;
      background: #f0f4ff;
      box-shadow: inset 2px 2px 6px #d1d9e6, inset -2px -2px 6px #ffffff;
      font-size: 1rem;
    }

    input:focus {
      outline: none;
      box-shadow: inset 2px 2px 6px #b3b3b3, inset -2px -2px 6px #ffffff;
    }

    button {
      width: 100%;
      padding: 0.9rem 1.2rem;
      font-size: 0.95rem;
      font-weight: bold;
      color: #fff;
      background: var(--button-gradient);
      border: none;
      border-radius: 2rem;
      cursor: pointer;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    }

    .manager-card {
      overflow: hidden;
      word-wrap: break-word;
      background: #ffffff;
      border-radius: 1.5rem;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.05);
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .manager-info {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .manager-info p {
      margin: 0.4rem 0 0.2rem;
      color: #555;
      font-weight: 500;
      font-size: 0.95rem;
    }

    .manager-info input {
      font-size: 0.95rem;
      padding: 0.7rem 1rem;
      border-radius: 1.5rem;
      border: none;
      background: #f0f4ff;
      box-shadow: inset 2px 2px 6px #d1d9e6, inset -2px -2px 6px #ffffff;
      width: 100%;
      box-sizing: border-box;
    }

    .manager-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: space-between;
    }

    .manager-actions button {
      width: 48%;
      padding: 0.7rem 1rem;
      font-size: 0.9rem;
    }

    /* 📱 Responsive */
    @media (max-width: 768px) {
      #menuToggle {
        display: block;
      }

      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .container {
        margin-left: 0;
        padding-top: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <!-- 🔝 Header -->
  <header>
    <h1>Manage Managers</h1>
    <button id="menuToggle">☰</button>
  </header>

  <!-- 📋 Sidebar -->
  <nav class="sidebar" id="sidebar">
    <h2>Admin Menu</h2>
    <a href="admin.html">Dashboard</a>
    <a href="admin-managers.html">Manage Managers</a>
    <a href="admin-upload-leads.html">Upload Leads</a>
    <a href="admin-upload-projects.html">Upload Projects</a>
    <a href="/logout" style="background: linear-gradient(145deg, #f271c4, #aa52f2); margin-top: 1.5rem;">Logout</a>
  </nav>

  <!-- 📦 Content -->
  <div class="container">
    <section class="card">
      <h2>Add New Manager</h2>
      <div class="manager-info">
        <p><strong>Phone:</strong></p>
        <input type="text" id="newPhone" placeholder="Phone Number" />
        <p><strong>Password:</strong></p>
        <input type="password" id="newPassword" placeholder="Password" />
      </div>
      <button onclick="addManager()">➕ Add Manager</button>
    </section>

    <section class="card">
      <h2>Manager List</h2>
      <div id="managerCards"></div>
    </section>
  </div>

  <!-- 🧠 Script -->
  <script>
    const toggleBtn = document.getElementById("menuToggle");
    const sidebar = document.getElementById("sidebar");

    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("open");
    });

    async function loadManagers() {
      const res = await fetch("/admin/managers");
      const managers = await res.json();
      const container = document.getElementById("managerCards");
      container.innerHTML = "";

      managers.forEach(manager => {
        const div = document.createElement("div");
        div.className = "manager-card";

        div.innerHTML = `
          <div class="manager-info">
            <p><strong>ID:</strong> ${manager.id}</p>
            <p><strong>Phone:</strong></p>
            <input value="${manager.phone}" onchange="markUpdated(${manager.id}, this.value, 'phone')">
            <p><strong>Password:</strong></p>
            <input type="password" value="${manager.password}" onchange="markUpdated(${manager.id}, this.value, 'password')">
          </div>
          <div class="manager-actions">
            <button onclick="updateManager(${manager.id})">Update</button>
            <button onclick="deleteManager(${manager.id})">Delete</button>
          </div>
        `;

        container.appendChild(div);
      });
    }

    const managerUpdates = {};

    function markUpdated(id, value, field) {
      if (!managerUpdates[id]) managerUpdates[id] = {};
      managerUpdates[id][field] = value;
    }

    async function updateManager(id) {
      const data = managerUpdates[id];
      if (!data) return alert("No changes to update.");

      const res = await fetch(`/admin/managers/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (res.ok) {
        alert("Updated!");
        loadManagers();
      } else {
        alert("Failed to update");
      }
    }

    async function deleteManager(id) {
      if (!confirm("Are you sure you want to delete this manager?")) return;

      const res = await fetch(`/admin/managers/${id}`, { method: "DELETE" });
      if (res.ok) {
        alert("Deleted!");
        loadManagers();
      } else {
        alert("Failed to delete");
      }
    }

    async function addManager() {
      const phone = document.getElementById("newPhone").value.trim();
      const password = document.getElementById("newPassword").value.trim();

      if (!phone || !password) {
        alert("Please enter phone and password");
        return;
      }

      const res = await fetch("/admin/managers", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ phone, password })
      });

      if (res.ok) {
        alert("Manager added!");
        document.getElementById("newPhone").value = "";
        document.getElementById("newPassword").value = "";
        loadManagers();
      } else {
        const err = await res.json();
        alert("Failed: " + (err.detail || "Unknown error"));
      }
    }

    loadManagers();
  </script>
</body>
</html>